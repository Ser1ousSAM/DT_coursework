# Decision theory coursework

*Problem*:

Determining the quality of wine


*Description*:

Here are used chemical and physical analysis to determine the quality of wine with kNN algorithm


*Decision*:

Bad, normal or good wine



[Введение	3](#__refheading___toc1822_2021410022)

[Постановка задачи	4](#__refheading___toc1822_2021410043)

[Теоретическая часть	5](#__refheading___toc1824_2021410043)

[Практическая часть	7](#__refheading___toc1826_2021410043)

[Предобработка данных	7](#__refheading___toc1828_2021410043)

[Обучение	15](#__refheading___toc1830_2021410043)

[Тестирование	17](#__refheading___toc1049_2420976292)

[Заключение	18](#__refheading___toc1832_2021410043)

[Список литературы и интернет-ресурсов	19](#__refheading___toc1834_2021410043)

# <a name="__refheading___toc1822_2021410022"></a>**Введение**

Виноделие — это искусство, требующее глубоких знаний и опыта. Оценка качества вина является важным этапом производства, который включает в себя множество параметров, таких как аромат, вкус и цвет. В современном мире существует огромное количество различных сортов вин, и каждое из них по-своему уникально.

Одним из символов социалистического общества является ответственное отношение к потреблению и умение разбираться в том, что мы едим и пьем. В контексте напитков с использованием машинного обучения возможно достичь более объективной оценки и определения качества вина для народных масс.

Но как обычному человеку, без особых знаний, удостовериться, насколько качественным может быть вино? Как оценить это качество, не имея под рукой искусного сомелье? Тут на помощь приходит машинное обучение, с помощью которого можно формализовать данную задачу для обывателя.

В данной курсовой работе рассматривается применение алгоритма *k* ближайших соседей (*kNN*) для решения задачи распознавания качества вина. Будет строиться модель для определения класса вина (плохое, нормальное, хорошее) на основе характеристик, таких как содержание сахара, кислотности, алкоголя и других, описанных в теоретической части.

**Лицо принимающее решение** — человек, желающий употребить винный напиток. Или же человек, занимающийся оптовой закупкой винной продукции.

## <a name="__refheading___toc1822_2021410043"></a>**Постановка задачи**

Цель: Определить качество вина.

Исходные данные: Анализ\* физико-химических свойств выбранного вина. Для решения задачи будет использоваться материал из [открытого источника](https://www.kaggle.com/datasets/uciml/red-wine-quality-cortez-et-al-2009), собранный на основе различных вариаций португальского вина "*Vinho Verde*" ("Винью Верде").

Ожидаемый результат: Программа для определения качества вина.

Критерий оценки: Совпадение результатов материала обучения с результатами материалов экзамена.

Определим, следующие уровни оценок вин:

\- хорошее - 5-6

\- нормальное 3-4

\- плохое 1-2

Пользователю будет выдана оценка вина и один из трёх вышеописанных вердиктов.

*Анализ физико-химических свойств можно провести в специализированной лаборатории, например, [здесь](https://prse.ru/ekspertizy/tovarovedcheskie-ekspertizy/ekspertiza-alkogolnyh-napitkov).

# <a name="__refheading___toc1824_2021410043"></a>**Теоретическая часть**

**Теория принятия решений** — область исследования, вовлекающая понятия и методы математики, статистики, экономики, менеджмента и психологии с целью изучения закономерностей выбора людьми путей решения проблем и задач, а также способов достижения желаемого результата.

**Гистограмма** — способ представления табличных данных в графическом виде — в виде столбчатой диаграммы.

**График рассеяния (точечная диаграмма)** — показывает распределение элементов множества в плоскости между двумя переменными.

**Диаграммы размаха** («ящик с усами») — это удобный способ визуального представления групп числовых данных через квартили.

**Пользовательский интерфейс** — средства удобного и эффективного взаимодействия пользователя с устройствами компьютера. Пользовательский интерфейс представляет собой набор пиктограмм (иконок) для различных программ, кнопки для различных действий и окна, в которых отображаются данные при работе с приложением.

**Корреляция** — это статистическая взаимосвязь двух или более величин, параметров, значений.

**Выброс** (статистика) — результат измерения, не подпадающий под общее распределение.

**Предобработка данных** — предварительное отсеивание данных, не влияющих на результат или данных являющихся выбросами.

**Тепловая карта (англ. *heatmap*)** — графическое представление данных, где индивидуальные значения в таблице отображаются при помощи цвета.

**Метод *k*-ближайших соседей (*k Nearest Neighbors*, или *kNN*)** – популярный алгоритм классификации, который используется в разных типах задач машинного обучения.

**Датасет** — набор данных (графических или текстовых).

В качестве алгоритма классификации будет использоваться *kNN*, подразумевающий собой поиск ближайших соседей (наикратчайших расстояний до соседей) на основе подсчёта расстояний от объекта материала экзамена до всех объектов материала обучения.

Расстояние между объектами (сумма квадратов разностей всех свойств двух вин):

```math
\sqrt{\sum_{i=1}^{n} (p_i - q_i)^2}
```

"Взвешенное" евклидово расстояние между объектами (сумма квадратов разностей всех свойств двух вин, но с учётом заданных весов):

```math
\sqrt{\sum_{i=1}^{n} w_i * (p_i - q_i)^2}
```

Исходные атрибуты вина:

*Fixed Acidity* (Фиксированная кислотность): большинство кислот, входящих в состав вина, либо фиксированные, либо нелетучие (не испаряются легко).

*Volatile Acidity* (Летучая кислотность):* количество уксусной кислоты в вине, слишком высокое содержание которой может привести к неприятному уксусному привкусу.

*Citric Acid* (Лимонная кислота): содержащаяся в небольших количествах лимонная кислота может придать винам "свежесть" и аромат.

*Residual Sugar* (Остаточный сахар):* количество сахара, остающегося после прекращения ферментации, редко встречается в винах с содержанием менее 1 грамма на литр.

*Chlorides* (Хлориды): количество соли в вине.

*Free Sulfur Dioxide* (Свободный диоксид серы): свободная форма SO2 существует в равновесии между молекулярным SO2 (в виде растворенного газа) и бисульфит-ионом.

*Total Sulfur Dioxide* (Общий диоксид серы): количество свободной и связанной форм S02; в низких концентрациях SO2 в основном не обнаруживается в вине, но в свободном SO2.

*Density* (Плотность): плотность воды близка к плотности обычной воды в зависимости от процентного содержания алкоголя и сахара.

*PH*: описывает, насколько кислым или основным является вино по шкале от 0 (очень кислое) до 14 (очень простое); большинство вин находятся в диапазоне 3-4.

*Sulphates* (Сульфаты): добавка к вину, которая может способствовать повышению уровня диоксида серы (S02), который действует как антимикробное средство.

*Alcohol* (Алкоголь): процент содержания алкоголя.

*Quality* (Качество): используется в качестве класса (оценка от 1 до 6) определения качества вина.

# <a name="__refheading___toc1826_2021410043"></a>**Практическая часть**

1. ## <a name="__refheading___toc1828_2021410043"></a>**Предобработка данных**

   Первым делом анализируются данные и происходит избавление от лишних атрибутов (если такие есть), которые не будут влиять на результат исследования.

Для этого создаётся [*Notebook*](https://colab.research.google.com/drive/1Xd4e3rhXDHjlxWd9rypOZsK__ZbhOuKA?usp=sharing) в *Google colab.* Рассматривается количество вин разных классов (в исходном датасете).

<p align="center">
  <img src="_attachments/1.png">
</p>
<p align="center">
  Рис. 1. Количество вин
</p>


Преобладают вина 5 и 6 (они же вина 3 и 4-ой категории, то есть нормальной, если смотреть на конечный результат).

Наблюдение закономерностей и рассмотрение гистограммы, графика рассеяния, графика размаха и столбчатой диаграммы.

<p align="center">
  <img src="_attachments/2.png">
</p>
<p align="center">
  Рис. 2. Графики fixed acidity
</p>

<p align="center">
  <img src="_attachments/3.png">
</p>
<p align="center">
  Рис. 3. Графики volatile acidity
</p>

<p align="center">
  <img src="_attachments/4.png">
</p>
<p align="center">
  Рис. 4. Графики citric acid
</p>

<p align="center">
  <img src="_attachments/5.png">
</p>
<p align="center">
  Рис. 5. Графики residual sugar
</p>

<p align="center">
  <img src="_attachments/6.png">
</p>
<p align="center">
  Рис. 6. Графики chlorides
</p>

<p align="center">
  <img src="_attachments/7.png">
</p>
<p align="center">
  Рис. 7. Графики free sulfur dioxide
</p>

<p align="center">
  <img src="_attachments/8.png">
</p>
<p align="center">
  Рис. 8. Графики total sulfur  dioxide
</p>

<p align="center">
  <img src="_attachments/9.png">
</p>
<p align="center">
  Рис. 9. Графики density
</p>

<p align="center">
  <img src="_attachments/10.png">
</p>
<p align="center">
  Рис. 10. Графики pH
</p>

<p align="center">
  <img src="_attachments/11.png">
</p>
<p align="center">
  Рис. 11. Графики  sulphates
</p>

<p align="center">
  <img src="_attachments/12.png">
</p>
<p align="center">
  Рис. 12. Графики alcohol
</p>

<p align="center">
  <img src="_attachments/13.png">
</p>
<p align="center">
  Рис. 13. Графики quality
</p>


По данным графикам можно сделать следующие выводы:

- Фиксированная кислотность не дает никаких указаний для классификации качества;
- Заметная тенденция к снижению летучей кислотности по мере того, как мы повышаем качество;
- Состав лимонной кислоты повышается по мере того, как мы повышаем качество получаемого продукта;
- Содержание хлоридов также снижается по мере того, как мы повышаем качество вина;
- Уровень сульфатов повышается вместе с качеством вина;
- Уровень алкоголя также повышается по мере повышения качества вина.

В наборе данных много выбросов, и поэтому они будут оптимизироваться их до желаемых значений верхней и нижней границ. А также удаляются повторы данных, которые можно заметить здесь:

<p align="center">
  <img src="_attachments/14.png">
</p>
<p align="center">
  Рис. 14. Повторения
</p>


После избавления от выбросов (Рис. 15) были построены графики во всё том же [*Notebook*](https://colab.research.google.com/drive/1Xd4e3rhXDHjlxWd9rypOZsK__ZbhOuKA#scrollTo=mHzBP5DAYsLg).

<p align="center">
  <img src="_attachments/15.png">
</p>
<p align="center">
  Рис. 15. Очистка
</p>


Далее проведён анализ и  для окончательного понимания того, можно ли выбросить какие-то свойства из исходного набора данных. Будет построена корреляционная таблица на основе качества и рассмотрено наибольшее и наименьшее влияние атрибутов.

<p align="center">
  <img src="_attachments/16.png">
</p>
<p align="center">
  Рис. 16. Корреляционная таблица
</p>


Далее сортируются все зависимости по убыванию:

<p align="center">
  <img src="_attachments/17.png">
</p>
<p align="center">
  Рис. 17. Отсортированные зависимости
</p>


Представление коэффициентов корреляции в виде графика:

<p align="center">
  <img src="_attachments/18.png">
</p>
<p align="center">
    Рис. 18. Коэффициенты корреляции
</p>


Очевидно, что три последних атрибута (*pH, free sulfur dioxide* и *residual sugar*) имеют наименьшее влияние на качество вина, а если смотреть на их коэффициенты корреляции, то они близки к сотым, значит, их можно было бы выбросить, но вместо этого можно пересмотреть подход к поиску расстояния и использовать "взвешенное" евклидово расстояние, где в качестве веса будут использоваться значения коэффициентов корреляции. Однако некоторые коэффициенты отрицательные (расстояние не может быть отрицательным), поэтому их необходимо сделать положительными, а уже положительные умножить на 2, чтобы сохранить их значимость.

## <a name="__refheading___toc1830_2021410043"></a>**Обучение**

Производится разбиение исходных материалов на две части: тренировочные и экзаменационные в соотношении 1:3. Получим следующее количество по классам:

| *Classes* |  1   |  2   |  3   |  4   |  5   |  6   |
| :-------: | :--: | :--: | :--: | :--: | :--: | :--: |
|   *All*   |  10  |  53  | 576  | 535  | 165  |  17  |
|  *Train*  |  8   |  40  | 432  | 401  | 124  |  13  |
|  *Exam*   |  2   |  13  | 144  | 134  |  43  |  4   |

Таблица. 1. Разбиение материала

Параметр *k* будет определяться следующим образом: берётся любое *k* от 1 до *n*, где *n* —  количество элементов выборки. Это *k* является подходящим тогда и только тогда, когда *k* % количество классов = 1, в противном случае возникает неопределённость. В нашем случае *k* % 6 = 1.

Находится процент распознавания классов вина путём деления количества совпадений на количество экзаменационных материалов:

<p align="center">
  <img src="_attachments/19.png">
</p>
<p align="center">
    Рис. 19. Функция процента распознавания класса
</p>

<p align="center">
  <img src="_attachments/20.png">
</p>
<p align="center">
    Рис. 20. Результат процесса распознавания класса
</p>


Конечный результат: должен быть одним из 3-х оценок, в зависимости от класса вина. Далее рассмотрено, сколько вин попадают в свою категорию:

<p align="center">
  <img src="_attachments/21.png">
</p>
<p align="center">
    Рис. 21. Функция процента распознавания категории
</p>

<p align="center">
  <img src="_attachments/22.png">
</p>
<p align="center">
    Рис. 22. Результат процесса распознавания категории
</p>


## <a name="__refheading___toc1049_2420976292"></a>**Тестирование**

Далее будут рассмотрены случаи ошибок и совпадений:

<p align="center">
  <img src="_attachments/23.png">
</p>
<p align="center">
    Рис. 23. Совпадение категории и ошибка
</p>

<p align="center">
  <img src="_attachments/24.png">
</p>
<p align="center">
    Рис. 24. Совпадение категории и класса
</p>

<p align="center">
  <img src="_attachments/25.png">
</p>
<p align="center">
    Рис. 25. Ошибка предсказания класса и категории
</p>


Замечено, что наблюдаются ошибки второго рода, однако отклонений на 2 категории не наблюдалось.

# <a name="__refheading___toc1832_2021410043"></a>**Заключение**

В данной курсовой работе был использован алгоритм распознавания *k*-ближайшего соседа для решения многокритериальной задачи на реальных данных. С помощью средств аналитики была произведена обработка первичных данных, в результате которой датасет стал максимально независим для материалов обучения и экзамена, также при исследовании данных были получены весовые коэффициенты для подсчёта расстояний между точками.

В результате проведенной работы были улучшены знания и понимание решений многокритериальных задач, а также получен опыт программирования на языке *Go*.

Работа выложена на [*GitHub*](https://github.com/Ser1ousSAM/DT_coursework) и добавлена в портфолио автора.

# <a name="__refheading___toc1834_2021410043"></a>**Список литературы и интернет-ресурсов**

1.  <https://colab.research.google.com/drive/1Xd4e3rhXDHjlxWd9rypOZsK__ZbhOuKA?usp=sharing> (Анализ графиков в Google colab)

2.  <https://habr.com/ru/articles/149693/> (Статья про алгоритм *kNN*)

3.  <https://prse.ru/ekspertizy/tovarovedcheskie-ekspertizy/ekspertiza-alkogolnyh-napitkov> (Экспертиза вина)

4.  <https://www.kaggle.com/datasets/uciml/red-wine-quality-cortez-et-al-2009> (Используемый датасет)

5.  <https://go.dev/doc/> (Документация по Golang)

6.  https://seaborn.pydata.org/> (Документация по отрисовке графиков в Python)
7.  https://github.com/Ser1ousSAM/DT_coursework> (Ссылка на программу)

